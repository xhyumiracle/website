<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Runtime | The AssemblyScript Book</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#007acc">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <meta name="description" content="Because nobody enjoys being bullied by malloc, free and friends.">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="preload" href="/assets/css/0.styles.6b61c7e6.css" as="style"><link rel="preload" href="/assets/js/app.8c582b19.js" as="script"><link rel="preload" href="/assets/js/4.bff817ab.js" as="script"><link rel="preload" href="/assets/js/3.414e7e2a.js" as="script"><link rel="preload" href="/assets/js/34.c2371ed2.js" as="script"><link rel="prefetch" href="/assets/js/10.b593aa85.js"><link rel="prefetch" href="/assets/js/11.e70694b8.js"><link rel="prefetch" href="/assets/js/12.eac7b90f.js"><link rel="prefetch" href="/assets/js/13.a23bc4f4.js"><link rel="prefetch" href="/assets/js/14.553e819e.js"><link rel="prefetch" href="/assets/js/15.bed349ea.js"><link rel="prefetch" href="/assets/js/16.9e12fbb3.js"><link rel="prefetch" href="/assets/js/17.6d931105.js"><link rel="prefetch" href="/assets/js/18.05443e93.js"><link rel="prefetch" href="/assets/js/19.7ca8822c.js"><link rel="prefetch" href="/assets/js/20.ba614be4.js"><link rel="prefetch" href="/assets/js/21.71357c31.js"><link rel="prefetch" href="/assets/js/22.7707743c.js"><link rel="prefetch" href="/assets/js/23.3debcc31.js"><link rel="prefetch" href="/assets/js/24.ee2d454f.js"><link rel="prefetch" href="/assets/js/25.4832a41c.js"><link rel="prefetch" href="/assets/js/26.1f14f079.js"><link rel="prefetch" href="/assets/js/27.009b8d6a.js"><link rel="prefetch" href="/assets/js/28.4e6b40ed.js"><link rel="prefetch" href="/assets/js/29.81f7f2d7.js"><link rel="prefetch" href="/assets/js/30.c82548b0.js"><link rel="prefetch" href="/assets/js/31.0484fd41.js"><link rel="prefetch" href="/assets/js/32.3d5d1506.js"><link rel="prefetch" href="/assets/js/33.ef922419.js"><link rel="prefetch" href="/assets/js/35.5e52ddcf.js"><link rel="prefetch" href="/assets/js/36.23b969cf.js"><link rel="prefetch" href="/assets/js/37.052a44c0.js"><link rel="prefetch" href="/assets/js/38.b6dada99.js"><link rel="prefetch" href="/assets/js/39.83ba9971.js"><link rel="prefetch" href="/assets/js/40.e67718e9.js"><link rel="prefetch" href="/assets/js/41.3c2af517.js"><link rel="prefetch" href="/assets/js/42.37313a96.js"><link rel="prefetch" href="/assets/js/43.d1dbc5e9.js"><link rel="prefetch" href="/assets/js/44.36362945.js"><link rel="prefetch" href="/assets/js/45.66c2271c.js"><link rel="prefetch" href="/assets/js/46.db7cc0c0.js"><link rel="prefetch" href="/assets/js/47.4dabbc21.js"><link rel="prefetch" href="/assets/js/48.e019f5bc.js"><link rel="prefetch" href="/assets/js/49.d69a4921.js"><link rel="prefetch" href="/assets/js/5.87fa113e.js"><link rel="prefetch" href="/assets/js/50.42fa0e80.js"><link rel="prefetch" href="/assets/js/51.4aa28dcb.js"><link rel="prefetch" href="/assets/js/52.83d4a8ce.js"><link rel="prefetch" href="/assets/js/53.52dfae86.js"><link rel="prefetch" href="/assets/js/54.7945d593.js"><link rel="prefetch" href="/assets/js/6.01d77bdc.js"><link rel="prefetch" href="/assets/js/7.eb42814d.js"><link rel="prefetch" href="/assets/js/8.c2cacdf2.js"><link rel="prefetch" href="/assets/js/9.f48a83b6.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.2967e2f6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6b61c7e6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7c0e63ba><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/icon.svg" alt="The AssemblyScript Book" class="logo"> <span class="site-name can-hide">The AssemblyScript Book</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/introduction.html" class="nav-link">
  Documentation
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Examples" class="dropdown-title"><span class="title">Examples</span> <span class="arrow down"></span></button> <button type="button" aria-label="Examples" class="mobile-dropdown-title"><span class="title">Examples</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/examples.html" class="nav-link">
  Overview
</a></li><li class="dropdown-item"><!----> <a href="/built-with-assemblyscript.html" class="nav-link">
  Built with AssemblyScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Community" class="dropdown-title"><span class="title">Community</span> <span class="arrow down"></span></button> <button type="button" aria-label="Community" class="mobile-dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/AssemblyScript/assemblyscript/blob/main/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Contributing guidelines
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/AssemblyScript/assemblyscript/blob/main/CODE_OF_CONDUCT.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Code of Conduct
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><h4>
          Social
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://twitter.com/AssemblyScript" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://discord.gg/assemblyscript" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          Q&amp;A
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://stackoverflow.com/questions/tagged/assemblyscript" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Stack Overflow
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://opencollective.com/assemblyscript" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Support us
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/AssemblyScript" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/introduction.html" class="nav-link">
  Documentation
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Examples" class="dropdown-title"><span class="title">Examples</span> <span class="arrow down"></span></button> <button type="button" aria-label="Examples" class="mobile-dropdown-title"><span class="title">Examples</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/examples.html" class="nav-link">
  Overview
</a></li><li class="dropdown-item"><!----> <a href="/built-with-assemblyscript.html" class="nav-link">
  Built with AssemblyScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Community" class="dropdown-title"><span class="title">Community</span> <span class="arrow down"></span></button> <button type="button" aria-label="Community" class="mobile-dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/AssemblyScript/assemblyscript/blob/main/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Contributing guidelines
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/AssemblyScript/assemblyscript/blob/main/CODE_OF_CONDUCT.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Code of Conduct
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><h4>
          Social
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://twitter.com/AssemblyScript" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://discord.gg/assemblyscript" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          Q&amp;A
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://stackoverflow.com/questions/tagged/assemblyscript" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Stack Overflow
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://opencollective.com/assemblyscript" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Support us
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/AssemblyScript" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/introduction.html" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/introduction.html#from-a-webassembly-perspective" class="sidebar-link">From a WebAssembly perspective</a></li><li class="sidebar-sub-header"><a href="/introduction.html#from-a-javascript-perspective" class="sidebar-link">From a JavaScript perspective</a></li><li class="sidebar-sub-header"><a href="/introduction.html#frequently-asked-questions" class="sidebar-link">Frequently asked questions</a></li></ul></li><li><a href="/getting-started.html" class="sidebar-link">Getting started</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/getting-started.html#setting-up-a-new-project" class="sidebar-link">Setting up a new project</a></li><li class="sidebar-sub-header"><a href="/getting-started.html#working-with-your-module" class="sidebar-link">Working with your module</a></li><li class="sidebar-sub-header"><a href="/getting-started.html#the-journey-ahead" class="sidebar-link">The journey ahead</a></li></ul></li><li><a href="/compiler.html" class="sidebar-link">Using the compiler</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/compiler.html#compiler-options" class="sidebar-link">Compiler options</a></li><li class="sidebar-sub-header"><a href="/compiler.html#configuration-file" class="sidebar-link">Configuration file</a></li><li class="sidebar-sub-header"><a href="/compiler.html#programmatic-usage" class="sidebar-link">Programmatic usage</a></li><li class="sidebar-sub-header"><a href="/compiler.html#host-bindings" class="sidebar-link">Host bindings</a></li><li class="sidebar-sub-header"><a href="/compiler.html#debugging-2" class="sidebar-link">Debugging</a></li><li class="sidebar-sub-header"><a href="/compiler.html#transforms" class="sidebar-link">Transforms</a></li><li class="sidebar-sub-header"><a href="/compiler.html#portability" class="sidebar-link">Portability</a></li></ul></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Using the language</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/concepts.html" class="sidebar-link">Concepts</a></li><li><a href="/types.html" class="sidebar-link">Types</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Standard library</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/status.html" class="sidebar-link">Implementation status</a></li></ul></section></li><li><a href="/runtime.html" aria-current="page" class="active sidebar-link">Using the runtime</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/runtime.html#variants" class="sidebar-link">Variants</a></li><li class="sidebar-sub-header"><a href="/runtime.html#interface" class="sidebar-link">Interface</a></li><li class="sidebar-sub-header"><a href="/runtime.html#memory-layout" class="sidebar-link">Memory layout</a></li><li class="sidebar-sub-header"><a href="/runtime.html#calling-convention" class="sidebar-link">Calling convention</a></li></ul></li></ul> </aside> <main class="page" data-v-bb3fd134> <div class="theme-default-content content__default" data-v-bb3fd134><h1 id="runtime"><a href="#runtime" class="header-anchor">#</a> Runtime</h1> <p>The AssemblyScript runtime implements the necessary bits for memory management and garbage collection. It is largely invisible to a developer but can become relevant in advanced use cases, for example when integrating AssemblyScript in new environments.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If not applicable to your use case, i.e. it is not necessary to interact with the runtime directly, you can safely skip this section.</p></div> <h2 id="variants"><a href="#variants" class="header-anchor">#</a> Variants</h2> <p>The runtime comes in different flavors, each useful in different use cases. The desired runtime can be specified with the <code>--runtime</code> compiler option:</p> <div class="language- extra-class"><pre class="language-text"><code>  --runtime             Specifies the runtime variant to include in the program.

                         incremental  TLSF + incremental GC (default)
                         minimal      TLSF + lightweight GC invoked externally
                         stub         Minimal runtime stub (never frees)
                         ...          Path to a custom runtime implementation

  --exportRuntime       Exports the runtime helpers (__new, __collect etc.).
</code></pre></div><p>The default <code>incremental</code> runtime provides the full package recommended in most use cases. The <code>minimal</code> runtime is a stripped down variant (no shadow stack, no heuristic, simpler algorithm, smaller and more efficient) that is not automated and requires calling <code>__collect</code> externally at appropriate times (when there are no more values on the WebAssembly stack, which would be the case when WebAssembly calls out to the host, directly or indirectly), whereas the <code>stub</code> runtime does not provide a garbage collector at all and never frees (simple bump allocation, extremely small).</p> <p>For example, the <code>stub</code> runtime can be useful where modules are short-lived and collected as a whole anyhow, while the <code>minimal</code> runtime provides a compromise for use cases where it is sufficient to collect garbage manually, occasionally, say where a module performs a fixed amount of work before being invoked again.</p> <p>In case of doubt, use <code>incremental</code>, but feel free to experiment with the other potentially more efficient variants where a use case permits.</p> <h2 id="interface"><a href="#interface" class="header-anchor">#</a> Interface</h2> <p>Using the <code>--exportRuntime</code> compiler option, the runtime interface can be exported from the module to the host, so it becomes possible to allocate new managed objects and invoke the garbage collector externally.</p> <p>It is typically not necessary to invoke the runtime interface manually since generated bindings take care of all the internals. In environments where bindings are not yet available, however, the runtime interface can be utilized to provide the necessary integration.</p> <ul><li><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">__new</span><span class="token punctuation">(</span>size<span class="token operator">:</span> <span class="token builtin">usize</span><span class="token punctuation">,</span> id<span class="token operator">:</span> <span class="token builtin">u32</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">usize</span>
</code></pre></div><p>Allocates a new garbage collected instance of the object represented by the specified class id, of at least the specified size. Returns the pointer to the object (pointing at its data, not its internal header).</p></li> <li><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">__pin</span><span class="token punctuation">(</span>ptr<span class="token operator">:</span> <span class="token builtin">usize</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">usize</span>
</code></pre></div><p>Pins the object pointed to by <code>ptr</code> externally so it and any object it references do not become garbage collected. Note that the same object cannot be pinned more than once.</p> <p>An external object that is not referenced from within WebAssembly must be pinned whenever an allocation might happen in between allocating it and passing it to WebAssembly. If not pinned, the allocation may trigger the garbage collector to step, which would prematurely collect the object and lead to undefined behavior.</p></li> <li><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">__unpin</span><span class="token punctuation">(</span>ptr<span class="token operator">:</span> <span class="token builtin">usize</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</code></pre></div><p>Unpins the object pointed to by <code>ptr</code> externally so it can become garbage collected. Note that the respective object must have been pinned before for the unpin operation to succeed.</p></li> <li><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">__collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</code></pre></div><p>Performs a full garbage collection.</p></li> <li><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> __rtti_base<span class="token operator">:</span> <span class="token builtin">usize</span>
</code></pre></div><p>Pointer to runtime type information in linear memory. RTTI contains information about the various classes utilized in a binary, mapping class ids to object kinds, their key and value layout, and base classes. Its layout is described in detail in <a href="https://github.com/AssemblyScript/assemblyscript/blob/main/std/assembly/shared/typeinfo.ts" target="_blank" rel="noopener noreferrer">shared/typeinfo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Using RTTI, it becomes possible to implement <code>instanceof</code> for example, or to tell strings, arrays etc. apart.</p></li></ul> <h2 id="memory-layout"><a href="#memory-layout" class="header-anchor">#</a> Memory layout</h2> <p>Overall, AssemblyScript partitions liner memory as follows:</p> <table><thead><tr><th>Region</th> <th>Start offset</th> <th>End offset</th> <th>Description</th></tr></thead> <tbody><tr><td>Static data</td> <td><code>0</code></td> <td><code>__data_end</code></td> <td>Contents of static strings, arrays, etc.</td></tr> <tr><td>Managed stack</td> <td><code>__data_end</code></td> <td><code>__heap_base</code></td> <td>Present only if the incremental runtime is used.</td></tr> <tr><td>Heap</td> <td><code>__heap_base</code></td> <td><code>memory.size() &lt;&lt; 16</code></td> <td>Remaining space is used for dynamic allocations. Can grow.</td></tr></tbody></table> <h3 id="header-layout"><a href="#header-layout" class="header-anchor">#</a> Header layout</h3> <p>Any kind of managed object in AssemblyScript utilizes a managed header for the runtime to operate on:</p> <table><thead><tr><th style="text-align:left;">Name</th> <th style="text-align:right;">Offset</th> <th style="text-align:left;">Type</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;">mmInfo</td> <td style="text-align:right;">-20</td> <td style="text-align:left;">usize</td> <td style="text-align:left;">Memory manager info</td></tr> <tr><td style="text-align:left;">gcInfo</td> <td style="text-align:right;">-16</td> <td style="text-align:left;">usize</td> <td style="text-align:left;">Garbage collector info</td></tr> <tr><td style="text-align:left;">gcInfo2</td> <td style="text-align:right;">-12</td> <td style="text-align:left;">usize</td> <td style="text-align:left;">Garbage collector info</td></tr> <tr><td style="text-align:left;">rtId</td> <td style="text-align:right;">-8</td> <td style="text-align:left;">u32</td> <td style="text-align:left;">Unique id of the concrete class</td></tr> <tr><td style="text-align:left;">rtSize</td> <td style="text-align:right;">-4</td> <td style="text-align:left;">u32</td> <td style="text-align:left;">Size of the data following the header</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:right;"></td> <td style="text-align:left;"></td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:right;">0</td> <td style="text-align:left;"></td> <td style="text-align:left;">Payload starts here</td></tr></tbody></table> <p>References to an object always point at the start of the payload, with the header beginning 20 bytes before. Null references are just the value <code>0</code>. When working with an AssemblyScript module externally, knowing the memory layout can be helpful to for example obtain an object's class id or size. Invoking <code>__new</code> automatically prepends a managed header and registers the object with the GC, using the provided class id for <code>rtId</code> and the provided size for <code>rtSize</code>.</p> <h3 id="class-layout"><a href="#class-layout" class="header-anchor">#</a> Class layout</h3> <p>Class fields are laid out similarly to C structs, sequentially and without packing. Each field is aligned to its type's native alignment, potentially leaving padding in between. If a class has the <code>@unmanaged</code> decorator, it effectively only describes a region of memory as if it were a struct that does not utilize a managed header, is not garbage collected, and can be used with <code>heap.free</code>. Managed classes with a managed header cannot be manually freed, and managed and unmanaged classes cannot be mixed (e.g. extend from each other).</p> <p>Standard library data types use the following layouts:</p> <table><thead><tr><th>Class</th> <th>Description</th></tr></thead> <tbody><tr><td>ArrayBuffer</td> <td>Buffers always use class id <code>0</code>, with their untyped data as the payload.</td></tr> <tr><td>String</td> <td>Strings always use class id <code>1</code>, with their 16-bit char codes (UTF-16 code units, allowing isolated surrogates like JS) as the payload. For example, if <code>rtSize</code> is <code>8</code>, the string's <code>.length</code> is <code>4</code>.</td></tr> <tr><td>TypedArray</td> <td>Typed arrays are objects composed of <code>buffer</code> (the reference to the viewed <code>ArrayBuffer</code>), <code>dataStart</code> (the start pointer into <code>buffer</code>) and <code>byteLength</code> fields, in this order. The respective id is picked sequentially and not predetermined.</td></tr> <tr><td>Array&lt;T&gt;</td> <td>Normal arrays use the same layout as typed arrays, with an additional mutable <code>length</code> field coming last.</td></tr> <tr><td>StaticArray&lt;T&gt;</td> <td>Static arrays do not need indirection due to not being resizable, and they have their data right in the payload, aligned according to <code>T</code>. Can be thought of as a typed buffer.</td></tr> <tr><td>Function</td> <td>Functions are objects composed of their table <code>index</code> and their lexical <code>env</code> (currently always <code>0</code>).</td></tr> <tr><td>Map/Set/...</td> <td>Other collection use more complex layouts. Please refer to their respective sources.</td></tr></tbody></table> <p>It is also possible to build custom data types that integrate with the GC by implementing the <code>__visit</code> interface (that iterates all references contained in an object of this kind). Please refer to the sources of preexisting data types for examples.</p> <h2 id="calling-convention"><a href="#calling-convention" class="header-anchor">#</a> Calling convention</h2> <p>AssemblyScript's calling convention is relatively straight forward, as it does not add additional parameters to functions or other behind-the-scenes magic. Note that generated bindings take care of the calling convention automatically, but other environments may want to adhere to it specifically.</p> <h3 id="basic-values"><a href="#basic-values" class="header-anchor">#</a> Basic values</h3> <p>Exported functions wrap basic numeric return values to their respective value ranges. Basic numeric values passed to exported functions are wrapped to their respective value ranges on demand.</p> <h3 id="managed-values"><a href="#managed-values" class="header-anchor">#</a> Managed values</h3> <p>Any kind of object is passed as a pointer into memory, and the host is expected to perform the steps necessary to exchange the value between linear memory and the host system. For example, when a string is passed from WebAssembly to the host or vice-versa, it is not its data that is passed but a pointer to the string's data in linear memory. In order to read the data, the managed header before the payload can be evaluated to obtain the string's byte length. Note that <a href="/compiler.html#host-bindings">host bindings</a> automate this process for common data types.</p> <h3 id="optional-arguments"><a href="#optional-arguments" class="header-anchor">#</a> Optional arguments</h3> <p>When an exported function allows one or multiple arguments to be omitted, the module must be informed of the number of significant arguments by calling <code>exports.__setArgumentsLength(numArgs)</code> before calling the export, so it can fill in default values. Omitted arguments are not evaluated, i.e. zeroes can be passed. Not calling the helper leads to undefined behavior. If a function has a fixed number of arguments, it is not necessary to call the helper. The helper may not be present if a module only exports functions with a fixed number of arguments.</p></div> <footer class="page-edit" data-v-bb3fd134><div class="edit-link"><a href="https://github.com/AssemblyScript/website/edit/main/src/runtime.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav" data-v-bb3fd134><p class="inner"><span class="prev">
      ←
      <a href="/status.html" class="prev">
        Implementation status
      </a></span> <!----></p></div> <div class="footer" data-v-bb3fd134 data-v-7c0e63ba><p data-v-bb3fd134 data-v-7c0e63ba><span class="item" data-v-bb3fd134 data-v-7c0e63ba>Apache-2.0 licensed</span>,
      <span class="item" data-v-bb3fd134 data-v-7c0e63ba>Copyright © 2020-2022</span> <span class="item" data-v-bb3fd134 data-v-7c0e63ba>The AssemblyScript Authors</span></p></div></main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8c582b19.js" defer></script><script src="/assets/js/4.bff817ab.js" defer></script><script src="/assets/js/3.414e7e2a.js" defer></script><script src="/assets/js/34.c2371ed2.js" defer></script>
  </body>
</html>
